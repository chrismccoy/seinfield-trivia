<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Trivia About Nothing</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script src="/js/trivia.js"></script>

    <style>
        [x-cloak] { display: none !important; }
        .blur-transition { transition: filter 0.3s ease, opacity 0.3s ease; }
        .min-h-card { min-height: 500px; }
        .font-logo { font-family: 'Times New Roman', serif; font-style: italic; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        seinfeld: {
                            yellow: '#f4e409',
                            red: '#e3342f',
                            blue: '#3490dc'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-900 text-slate-100 min-h-screen flex items-center justify-center font-sans antialiased p-4 overflow-y-scroll"
      data-session-prefix="<%= sessionConfig.SESSION_PREFIX %>"
      data-storage-key="<%= sessionConfig.LOCAL_STORAGE_KEY %>"
      data-session-id-length="<%= sessionConfig.SESSION_ID_LENGTH %>">

    <div x-data='triviaGame(<%- JSON.stringify(initialQuestion).replace(/\x3c/g, "\\x3c").replace(/\x3e/g, "\\x3e").replace(/\x27/g, "\\x27") %>)' class="w-full max-w-lg relative" role="main">

        <header class="mb-8 text-center blur-transition" :class="{'opacity-20 blur-sm': showWelcomeModal}">
            <h1 class="text-5xl font-extrabold text-seinfeld-yellow mb-2 font-logo tracking-tighter transform -rotate-2 drop-shadow-md">
                Seinfeld Trivia
            </h1>

            <div x-show="!gameEnded" class="flex flex-col gap-1">
                <p class="text-slate-300 text-sm font-bold" aria-live="polite">
                    Score: <span class="text-seinfeld-yellow" x-text="stats.correct"></span> / <span x-text="stats.total"></span>
                </p>
            </div>

            <p class="text-slate-400" x-show="gameEnded">That's a shame.</p>
        </header>

        <div x-show="showWelcomeModal"
             x-cloak
             class="absolute inset-0 z-50 flex items-center justify-center -mt-20"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             role="dialog"
             aria-labelledby="resume-heading"
             aria-modal="true">

            <div class="bg-gray-800 border-2 border-seinfeld-yellow p-8 rounded-lg shadow-2xl text-center w-full max-w-sm relative">
                <h2 id="resume-heading" class="text-2xl font-bold text-white mb-2">Giddy Up!</h2>
                <p class="text-slate-400 mb-6 text-sm">We found an active session. Continue where you left off?</p>

                <div class="flex flex-col gap-3">
                    <button @click="continueSession()"
                            class="w-full bg-seinfeld-yellow hover:bg-yellow-400 text-black font-bold py-3 px-4 rounded transition-colors shadow-lg flex justify-between items-center">
                        <span>Continue</span>
                        <span class="bg-black/10 px-2 py-1 rounded text-xs">
                            <span x-text="savedStats.correct"></span>/<span x-text="savedStats.total"></span>
                        </span>
                    </button>
                    <button @click="startFresh()"
                            class="w-full bg-gray-700 hover:bg-gray-600 text-slate-300 font-bold py-3 px-4 rounded transition-colors border border-gray-600 hover:text-white">
                        Start Fresh
                    </button>
                </div>
            </div>
        </div>

        <div class="blur-transition min-h-card relative" :class="{'opacity-20 pointer-events-none blur-sm': showWelcomeModal}">

            <div x-show="loading"
                 class="absolute inset-0 z-10 bg-gray-900/90 backdrop-blur-sm flex flex-col items-center justify-center rounded-2xl"
                 x-transition.opacity
                 role="status"
                 aria-label="Loading next question">
                <div class="animate-bounce text-4xl mb-4" aria-hidden="true">&#x1F968;</div>
                <p class="text-seinfeld-yellow animate-pulse font-bold">Checking the vault...</p>
            </div>

            <div x-show="fetchError"
                 x-cloak
                 class="mb-4 p-4 rounded bg-red-900/40 border border-red-700 text-red-300 text-sm text-center"
                 role="alert">
                <span x-text="fetchError"></span>
                <button @click="fetchNext()" class="underline ml-2 font-bold hover:text-white">Retry</button>
            </div>

            <div x-show="!gameEnded && currentQuestion"
                 class="bg-gray-800 rounded-lg shadow-xl overflow-hidden border border-gray-700 transition-all duration-300 h-full">

                <div class="bg-gray-900/80 px-6 py-3 border-b border-gray-700">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[10px] font-bold uppercase tracking-wider text-gray-500">Episode Info</span>
                        <span :class="{
                                'bg-green-900 text-green-300': currentQuestion.difficulty === 'easy',
                                'bg-yellow-900 text-yellow-300': currentQuestion.difficulty === 'medium',
                                'bg-red-900 text-red-300': currentQuestion.difficulty === 'hard',
                                'bg-gray-700 text-gray-300': !['easy','medium','hard'].includes(currentQuestion.difficulty)
                              }"
                              class="text-[10px] font-bold uppercase px-2 py-0.5 rounded shadow-sm"
                              role="status"
                              :aria-label="'Difficulty: ' + currentQuestion.difficulty">
                            <span x-text="currentQuestion.difficulty"></span>
                        </span>
                    </div>
                    <span x-text="currentQuestion.category" class="text-sm font-bold text-seinfeld-yellow leading-tight block"></span>
                </div>

                <div class="p-6">
                    <h2 class="text-xl font-medium mb-6 leading-relaxed min-h-[4rem] text-white" x-text="currentQuestion.question"></h2>

                    <div class="grid gap-3" role="group" aria-label="Answer choices">
                        <template x-for="(answer, idx) in allAnswers" :key="answer">
                            <button @click="selectAnswer(answer)"
                                    :disabled="hasAnswered"
                                    :aria-label="'Option ' + (idx + 1) + ': ' + answer"
                                    class="w-full text-left p-4 rounded-md transition-all duration-200 border relative group focus:outline-none focus:ring-2 focus:ring-seinfeld-yellow"
                                    :class="{
                                        'border-gray-600 hover:border-seinfeld-yellow hover:bg-gray-700': !hasAnswered,
                                        'border-green-500 bg-green-900/30': hasAnswered && answer === currentQuestion.correct_answer,
                                        'border-red-500 bg-red-900/30': hasAnswered && answer === selectedAnswer && answer !== currentQuestion.correct_answer,
                                        'opacity-50 border-gray-700': hasAnswered && answer !== currentQuestion.correct_answer && answer !== selectedAnswer
                                    }">
                                <span x-text="answer"></span>
                                <span x-show="hasAnswered && answer === currentQuestion.correct_answer"
                                      class="absolute right-4 top-4 text-green-500 font-bold text-xl" aria-hidden="true">&#x2713;</span>
                                <span x-show="hasAnswered && answer === selectedAnswer && answer !== currentQuestion.correct_answer"
                                      class="absolute right-4 top-4 text-red-500 font-bold text-xl" aria-hidden="true">&#x2715;</span>
                            </button>
                        </template>
                    </div>
                </div>

                <div x-show="hasAnswered" class="p-6 bg-gray-900/50 border-t border-gray-700 flex flex-col gap-6" x-transition aria-live="polite">
                    <div class="text-center">
                        <p x-show="isCorrect" class="text-green-400 font-bold text-lg mb-1">Giddy Up!</p>
                        <p x-show="!isCorrect" class="text-red-400 font-bold text-lg mb-1">No soup for you!</p>
                        <p x-show="!isCorrect" class="text-sm text-slate-400">
                            Answer: <span class="text-seinfeld-yellow font-bold" x-text="currentQuestion.correct_answer"></span>
                        </p>
                    </div>
                    <div class="flex gap-4 justify-center">
                        <button @click="endGame()"
                                class="px-6 py-3 rounded font-bold text-slate-400 border border-slate-600 hover:bg-gray-700 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400">
                            End
                        </button>
                        <button @click="fetchNext()"
                                class="px-8 py-3 rounded font-bold bg-seinfeld-yellow text-black hover:bg-yellow-400 transition-colors shadow-lg flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-seinfeld-yellow">
                            Next <span aria-hidden="true">&rarr;</span>
                        </button>
                    </div>
                </div>
            </div>

            <div x-show="gameEnded"
                 x-cloak
                 class="bg-gray-800 rounded-lg shadow-xl overflow-hidden border border-gray-700 p-8 text-center absolute inset-0 h-fit"
                 x-transition:enter="transition ease-out duration-500"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 role="region"
                 aria-label="Game results">

                <h2 class="text-3xl font-bold text-white mb-2">Session Complete</h2>
                <p class="text-slate-400 mb-8 text-sm">Are you master of your domain?</p>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-gray-900/50 p-4 rounded border border-gray-700 flex flex-col items-center">
                        <div class="text-4xl font-bold text-green-400 mb-1" x-text="stats.correct"></div>
                        <div class="text-xs uppercase tracking-wider text-slate-500 font-bold">Correct</div>
                    </div>
                    <div class="bg-gray-900/50 p-4 rounded border border-gray-700 flex flex-col items-center">
                        <div class="text-4xl font-bold text-red-400 mb-1" x-text="stats.total - stats.correct"></div>
                        <div class="text-xs uppercase tracking-wider text-slate-500 font-bold">Incorrect</div>
                    </div>
                </div>

                <div class="mb-8 text-left bg-gray-900/30 p-4 rounded border border-gray-700/50">
                    <div class="flex justify-between text-sm mb-2 font-bold">
                        <span class="text-slate-300">Accuracy</span>
                        <span class="text-seinfeld-yellow" x-text="calculatePercentage() + '%'"></span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden shadow-inner" role="progressbar" :aria-valuenow="calculatePercentage()" aria-valuemin="0" aria-valuemax="100">
                        <div class="bg-seinfeld-yellow h-4 rounded-full transition-all duration-1000 ease-out"
                             :style="`width: ${calculatePercentage()}%`"></div>
                    </div>
                </div>

                <button @click="startFresh()"
                        class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded transition-colors border border-gray-600 shadow-lg focus:outline-none focus:ring-2 focus:ring-seinfeld-yellow">
                    Start New Session
                </button>
            </div>
        </div>

    </div>

</body>
</html>
